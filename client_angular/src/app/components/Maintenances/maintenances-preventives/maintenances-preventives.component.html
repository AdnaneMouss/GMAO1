<div *ngIf="addSuccessful" class="fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-3 z-50">
  <i class="fas fa-check-circle text-2xl"></i>
  <span class="font-semibold">{{ successMessage }}</span>
</div>

<div *ngIf="updateSuccessful" class="fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-3 z-50">
  <i class="fas fa-check-circle text-2xl"></i>
  <span class="font-semibold">{{ successMessage }}</span>
</div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="alert alert-danger text-center mb-6 bg-red-100 text-red-700 p-4 rounded-xl shadow-md">
    {{ errorMessage }}
  </div>
  <div class="bg-white shadow-lg rounded-xl overflow-hidden p-6">
    <h2 class="text-3xl font-semibold text-gray-800 mb-4">Gestion des Maintenances Preventives</h2>
    <p class="text-gray-600 mb-6">Consultez et gérez les  de maintenance Preventives des équipements hospitaliers.</p>


  <div class="flex space-x-4 justify-end w-full sm:w-auto">
    <button
      [routerLink]="'/maintenances/historique'"
      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 hover:text-gray-900 transition duration-200 text-sm font-medium shadow-sm"
    >
      <i class="fas fa-history fa-sm"></i>
      Historique des maintenances
    </button>
   

  </div>



  <!-- Filtres -->
  <div class="flex flex-wrap justify-start gap-4 mb-6">
    <!-- Filtre par priorité -->
    <div class="relative w-full md:w-auto">
      <div class="relative">
        <select [(ngModel)]="selectedPriorite" (change)="filterMaintenancesByPriorite()"
                class="appearance-none w-full py-2 pl-10 pr-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
          <option value="">Trier par priorité</option>
          <option value="FAIBLE">FAIBLE</option>
          <option value="URGENTE">URGENTE</option>
          <option value="NORMALE">NORMALE</option>
        </select>
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <i class="fas fa-filter text-gray-500"></i> <!-- Icône de filtre -->
        </div>
      </div>
    </div>
    <!-- Filtre par statut -->
    <div class="relative w-full md:w-auto">
      <select [(ngModel)]="selectedStatus" (change)="filterMaintenancesByStatus()"
              class="w-full py-2 px-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
        <option value="">Trier par Statut</option>
        <option value="EN_ATTENTE" class="text-yellow-500">
          <i class="fas fa-clock"></i> EN_ATTENTE
        </option>
        <option value="EN_COURS" class="text-blue-500">
          <i class="fas fa-spinner"></i> EN_COURS
        </option>
        <option value="TERMINEE" class="text-green-500">
          <i class="fas fa-check-circle"></i> TERMINEE
        </option>
        <option value="ANNULEE" class="text-red-500">
          <i class="fas fa-times-circle"></i> ANNULEE
        </option>
      </select>
    </div>


    <div class="relative w-full md:w-auto">
      <input
        type="text"
        [(ngModel)]="selectedEquipement"
        (input)="filterMaintenancesByEquipement()"
        placeholder="Trier par Equipement"
        class="w-full py-2 px-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out"
      />
    </div>
    <div class="relative w-full md:w-auto">
      <input
        type="date"
        [(ngModel)]="dateDebutPrevue"
        (input)="filterMaintenancesBydateDebutPrevue()"
        placeholder="Trier par Equipement"
        class="w-full py-2 px-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out"
      />
    </div>
    <div class="relative w-full md:w-auto">
      <input
        type="date"
        [(ngModel)]="dateFinPrevue"
        (input)="filterMaintenancesBydatedateFinPrevue()"
        placeholder="Trier par Equipement"
        class="w-full py-2 px-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out"
      />
    </div>
    
    




   
    
   
    
  </div>

<!-- Conteneur des icônes -->
<div style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; gap: 1rem;">

<!-- Conteneur aligné horizontalement -->
<div style="display: flex; align-items: center; gap: 20px; position: fixed; top: 20px; right: 20px; z-index: 1000;">
  
  <!-- Icône de chat -->
  <div class="chat-icon" (click)="navigateToChat(); clearNotificationss()" style="cursor: pointer; position: relative;">
    <i class="fas fa-comments" style="font-size: 2rem; color: #4285f4;"></i>
    <span *ngIf="unreadMessagesCount > 0" class="notification-badge" style="
      position: absolute;
      top: -6px;
      right: -6px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
    ">
      {{ unreadMessagesCount > 9 ? '9+' : unreadMessagesCount }}
    </span>
  </div>

  <!-- Icône de notification -->
  <div class="notification-icon" (click)="toggleNotificationsPanel($event)" style="cursor: pointer; position: relative;">
    <i class="fas fa-bell" style="font-size: 2rem; color: #f39c12;"></i>
    <span *ngIf="notificationCount > 0" class="badge" style="
      position: absolute;
      top: -6px;
      right: -6px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
    ">
      {{ notificationCount }}
    </span>
  </div>

</div>


</div>

<!-- Panneau de notifications -->
<div *ngIf="showNotificationsPanel"
     class="notifications-panel"
     style="position: fixed; top: 70px; right: 20px; background: #fff; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); max-height: 300px; overflow-y: auto; width: 300px; z-index: 1000;">

  <!-- En-tête -->
  <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
    <h3 style="margin: 0;">Notifications</h3>
    <button (click)="clearNotifications()" style="background: none; border: none; color: #007bff; cursor: pointer;">Tout effacer</button>
  </div>

  <!-- Message si aucune notification -->
  <div *ngIf="notifications.length === 0" class="empty-message" style="margin-top: 10px; color: gray; text-align: center;">
    Aucune nouvelle notification
  </div>

  <!-- Liste des notifications -->
  <div *ngFor="let notif of notification" style="padding: 10px; border-top: 1px solid #eee;">
    <a [routerLink]="['/details-maintenance', notif.id]" style="text-decoration: none; color: inherit; display: block;">
      {{ notif.message }}
      <div class="notification-date" style="font-size: 12px; color: gray;">
       
      </div>
    </a>
  </div>

</div>







<div class="flex items-center mb-6">
  <!-- Bouton Démarrer (à gauche) -->
  <button
    class="flex items-center py-3 px-6 bg-gradient-to-r from-green-400 to-green-600 text-white rounded-xl shadow-xl transform transition duration-200 hover:scale-105 hover:from-green-500 hover:to-green-700 focus:outline-none focus:ring-4 focus:ring-green-300"
    (click)="togglePanel()" style="margin-right: 2cm;" 
  >
    <i class="fas fa-play-circle mr-2"></i>
    <span class="font-semibold">Démarrer une Maintenance</span>
  </button>

  <!-- Bouton Export -->
  <button class="text-green-600 hover:text-green-700 transition duration-200" (click)="exportToExcel()">
    <i class="fas fa-download fa-lg"></i>
  </button>
</div>



   
    

 
<!-- Tableau des Maintenances -->
<div class="overflow-x-auto rounded-xl shadow-md bg-white">
  <table class="min-w-full text-sm text-left border-collapse">
    <thead class="bg-green-700 text-white uppercase tracking-wide text-xs font-bold">
      <tr>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">#</th>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">equipement</th>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">Date Début</th>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">Date Fin</th>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">Statut</th>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">Priorité</th>
        <th class="py-4 px-6 text-left text-white font-bold uppercase tracking-wider text-sm">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      <tr *ngFor="let maintenance of getPaginatedMaintenances(); let i = index" class="hover:bg-green-50 transition duration-150 ease-in-out">
        <td class="py-4 px-6 text-gray-700 font-medium">{{ (currentPage * pageSize) + i + 1 }}</td>
        <td class="px-6 py-4">{{ maintenance.equipementNom }}</td>
        <td class="py-4 px-6 text-gray-700">{{ maintenance.dateDebutPrevue | date:'dd/MM/yyyy' }}</td>
        <td class="py-4 px-6 text-gray-700">{{ maintenance.dateFinPrevue | date:'dd/MM/yyyy' }}</td>
        <td class="py-4 px-6">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold leading-5"
                [ngClass]="{
                  'bg-yellow-100 text-yellow-800': maintenance.statut === 'EN_ATTENTE',
                  'bg-blue-100 text-blue-800': maintenance.statut === 'EN_COURS',
                  'bg-green-100 text-green-800': maintenance.statut === 'TERMINEE',
                  'bg-red-100 text-red-800': maintenance.statut === 'ANNULEE'
                }">
            <i class="fas fa-clock mr-1.5" *ngIf="maintenance.statut === 'EN_ATTENTE'"></i>
            <i class="fas fa-spinner mr-1.5 animate-spin" *ngIf="maintenance.statut === 'EN_COURS'"></i>
            <i class="fas fa-check-circle mr-1.5" *ngIf="maintenance.statut === 'TERMINEE'"></i>
            <i class="fas fa-times-circle mr-1.5" *ngIf="maintenance.statut === 'ANNULEE'"></i>
            {{ maintenance.statut | titlecase }}
          </span>
        </td>
        <td class="py-4 px-6">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold leading-5"
                [ngClass]="{
                  'bg-green-100 text-green-800': maintenance.priorite === 'FAIBLE',
                  'bg-yellow-100 text-yellow-800': maintenance.priorite === 'NORMALE',
                  'bg-red-100 text-red-800': maintenance.priorite === 'URGENTE'
                }">
            <i class="fas fa-arrow-down mr-1.5" *ngIf="maintenance.priorite === 'FAIBLE'"></i>
            <i class="fas fa-arrow-right mr-1.5" *ngIf="maintenance.priorite === 'NORMALE'"></i>
            <i class="fas fa-arrow-up mr-1.5" *ngIf="maintenance.priorite === 'URGENTE'"></i>
            {{ maintenance.priorite | titlecase }}
          </span>
        </td>
        <td class="py-4 px-6">
          <div class="flex space-x-2">
            <button
             
              [routerLink]="['/details-maintenance', maintenance.id]">
              <i class="fas fa-search mr-2 text-xl"></i>
            </button>
            <button (click)="confirmDelete(maintenance.id)">
              <i class="fas fa-times-circle mr-2 text-xl text-red-600"></i>
            </button>
            
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

  
  <!-- Pagination -->
  <div class="flex justify-between items-center p-4 bg-gray-50 rounded-b-lg">
    <div class="text-sm text-gray-700">
      Affichage de {{ (currentPage * pageSize) + 1 }} à 
      {{ getMin((currentPage + 1) * pageSize, filteredMaintenace.length) }}

      sur {{ filteredMaintenace.length }} éléments
    </div>
    <div class="flex space-x-2">
      <button 
        (click)="goToPage(0)" 
        [disabled]="currentPage === 0"
        class="px-3 py-1 border rounded-md disabled:opacity-50"
      >
        <i class="fas fa-angle-double-left"></i>
      </button>
      <button 
        (click)="prevPage()" 
        [disabled]="currentPage === 0"
        class="px-3 py-1 border rounded-md disabled:opacity-50"
      >
        <i class="fas fa-angle-left"></i>
      </button>
      
      <span class="px-3 py-1">Page {{ currentPage + 1 }} / {{ getTotalPages() }}</span>
      
      <button 
        (click)="nextPage()" 
        [disabled]="currentPage >= getTotalPages() - 1"
        class="px-3 py-1 border rounded-md disabled:opacity-50"
      >
        <i class="fas fa-angle-right"></i>
      </button>
      <button 
        (click)="goToPage(getTotalPages() - 1)" 
        [disabled]="currentPage >= getTotalPages() - 1"
        class="px-3 py-1 border rounded-md disabled:opacity-50"
      >
        <i class="fas fa-angle-double-right"></i>
      </button>
    </div>
  </div>

  <!-- Panneau d'ajout de la maintenance -->
  <!-- Panneau d'ajout de la maintenance -->
  <div *ngIf="showPanel" class="fixed inset-0 flex justify-center items-center z-50 bg-black bg-opacity-50">
    <div class="bg-white p-8 rounded-xl shadow-lg max-w-4xl w-full mx-4 overflow-y-auto max-h-[90vh]">
      <!-- En-tête du panneau -->
      <div class="flex justify-between items-center mb-8">
        <h4 class="text-3xl font-bold text-gray-800 flex items-center">
          <i class="fas fa-cogs text-blue-600 mr-3"></i> <!-- Icône changée (engrenages) -->
          Démarrer une maintenance
        </h4>
      
      </div>

      <!-- Formulaire de maintenance -->
      <form (ngSubmit)="addMaintenance()" class="space-y-8">
        <!-- Première partie - Champs essentiels -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Technicien maintenance --> 
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-user-cog text-blue-500 mr-2"></i> Technicien maintenance <span class="text-red-500">*</span>
            </label>
            <select
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.user"
              name="user"
              required
            >
              <option *ngFor="let user of filteredTechnicienUsers" [ngValue]="user">
                {{ user.id }} - {{ user.role }}
              </option>
            </select>
          </div>
      
          <!-- Action -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-tools text-blue-500 mr-2"></i> Action <span class="text-red-500">*</span>
            </label>
            <select
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.action"
              name="action"
              required
              (change)="onActionChange()"
            >
              <option value="VERIFICATION_PERFORMANCES">Vérification performances</option>
              <option value="NETTOYAGE_EQUIPEMENTS">Nettoyage équipements</option>
              <option value="CALIBRATION_EQUIPEMENTS">Calibration équipements</option>
              <option value="TEST_SECURITE">Test sécurité</option>
              <option value="MISE_A_JOUR">Mise à jour</option>
              <option value="REMPLACEMENT_PIECES">Remplacement pièces</option>
              <option value="INSPECTION_VISUELLE">Inspection visuelle</option>
              <option value="CONTROLE_CONNECTIVITE">Contrôle connectivité</option>
              <option value="VERIFICATION_SAUVEARDES">Vérification sauvegardes</option>
              <option value="FORMATION_ENTRETIEN">Formation entretien</option>
              <option value="AUTRE">AUTRE</option>
            </select>
      
            <!-- Champ pour préciser "Autre" -->
            <div *ngIf="newMaintenance.action === 'AUTRE'" class="mt-3">
              <label for="customAction" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                <i class="fas fa-edit text-blue-500 mr-2 text-sm"></i> Précisez :
              </label>
              <input
                id="customAction"
                type="text"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                [(ngModel)]="newMaintenance.autreAction"
                required
              />
            </div>
          </div>
      
          <!-- Bâtiment -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium flex items-center">
              <i class="fas fa-building text-blue-500 mr-2"></i> Bâtiment <span class="text-red-500">*</span>
            </label>
            <select id="batiment" [(ngModel)]="selectedBatiment" name="batiment" (change)="onBatimentChange()" required
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option *ngFor="let batiment of batiments" [value]="batiment.id">Batiment {{ batiment.numBatiment }}: {{ batiment.intitule }}</option>
            </select>
            <p *ngIf="!selectedBatiment" class="text-sm italic text-gray-500 mt-1 ml-1 flex items-start">
              <i class="fas fa-info-circle text-blue-500 mr-2 mt-0.5"></i> Choisissez un bâtiment pour accéder aux informations associées
            </p>
          </div>
      
          <!-- Étage (apparaît seulement si un bâtiment est sélectionné) -->
          <div *ngIf="selectedBatiment && etages.length > 0">
            <label class="block text-gray-700 mb-2 font-medium flex items-center">
              <i class="fas fa-layer-group text-blue-500 mr-2"></i> Étage <span class="text-red-500">*</span>
            </label>
            <select id="etage" [(ngModel)]="selectedEtage" name="etage" (change)="onEtageChange()" required
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option *ngFor="let etage of etages" [value]="etage.id">{{ etage.num }}</option>
            </select>
          </div>
      
          <!-- Salle (apparaît seulement si un étage est sélectionné) -->
          <div *ngIf="selectedEtage && salles.length > 0">
            <label class="block text-gray-700 mb-2 font-medium flex items-center">
              <i class="fas fa-door-open text-blue-500 mr-2"></i> Salle <span class="text-red-500">*</span>
            </label>
            <select id="salle" [(ngModel)]="selectedSalle" name="salle" (change)="onSalleChange()" required
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option *ngFor="let salle of salles" [value]="salle.id">{{ salle.num }}</option>
            </select>
          </div>
      
          <!-- Équipement -->
          <div *ngIf="selectedSalle && equipements.length > 0">
            <label class="block text-gray-700 mb-2 font-medium flex items-center">
              <i class="fas fa-toolbox text-blue-500 mr-2"></i> Équipement <span class="text-red-500">*</span>
            </label>
            <select id="equipement" [(ngModel)]="newMaintenance.equipementId" name="equipement" required
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                    (change)="onEquipementChange($event)">
              <option *ngFor="let equipement of equipements" [value]="equipement.id">
                {{ equipement.nom }} 
              </option>
            </select>
            <div *ngIf="selectedEquipementDetails" class="text-sm text-gray-700 mt-2 space-y-1 ml-1 bg-blue-50 p-3 rounded-lg">
              <div class="flex items-center"><i class="fas fa-box text-blue-400 mr-2 w-4"></i> <strong>Modèle:</strong> {{ selectedEquipementDetails.modele }}</div>
              <div class="flex items-center"><i class="fas fa-industry text-blue-400 mr-2 w-4"></i> <strong>Marque:</strong> {{ selectedEquipementDetails.marque }}</div>
              <div class="flex items-center"><i class="fas fa-info-circle text-blue-400 mr-2 w-4"></i> <strong>Statut:</strong> {{ selectedEquipementDetails.statut }}</div>
              <div class="flex items-center"><i class="fas fa-calendar-check text-blue-400 mr-2 w-4"></i> <strong>Dernière maintenance:</strong> {{ selectedEquipementDetails.dateDerniereMaintenance }}</div>
            </div>
          </div>
      
          <!-- Dates et durée -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-calendar-day text-blue-500 mr-2"></i> Date de début prévue <span class="text-red-500">*</span>
            </label>
            <input
              type="date"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.dateDebutPrevue"
              name="dateDebutPrevue"
              required
              (change)="validateDates()"
            />
          </div>
      
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-calendar-times text-blue-500 mr-2"></i> Date de fin prévue <span class="text-red-500">*</span>
            </label>
            <input
              type="date"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.dateFinPrevue"
              name="dateFinPrevue"
              required
              (change)="validateDates()"
            />
          </div>
      
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-hourglass-half text-blue-500 mr-2"></i> Durée d'Intervention (en jours)
            </label>
            <input
              type="text"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 focus:ring-0 cursor-not-allowed"
              name="dureeIntervention"
              [value]="newMaintenance.dureeIntervention > 0 ? newMaintenance.dureeIntervention + ' jours' : ''"
              readonly
            />
          </div>
      
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-calendar-plus text-blue-500 mr-2"></i> Date prochaine maintenance
            </label>
            <input
              type="date"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.dateProchainemaintenance"
              name="dateProchainemaintenance"
            />
          </div>
      
          <!-- Statut et Priorité -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-info-circle text-blue-500 mr-2"></i> Statut <span class="text-red-500">*</span>
            </label>
            <select
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.statut"
              name="statut"
              required
            >
              <option value="EN_ATTENTE" class="text-yellow-500">EN ATTENTE</option>
              <option value="EN_COURS" disabled>EN COURS</option>
              <option value="TERMINEE" disabled>TERMINEE</option>
              <option value="ANNULEE" disabled>ANNULEE</option>
            </select>
          </div>
      
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-exclamation-triangle text-blue-500 mr-2"></i> Priorité <span class="text-red-500">*</span>
            </label>
            <select
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="newMaintenance.priorite"
              name="priorite"
              required
            >
              <option value="FAIBLE" class="text-green-500">FAIBLE</option>
              <option value="NORMALE" class="text-yellow-500">NORMALE</option>
              <option value="URGENTE" class="text-red-500">URGENTE</option>
            </select>
          </div>
      
          <!-- Type de maintenance -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-cogs text-blue-500 mr-2"></i> Type de maintenance
            </label>
            <select
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              [(ngModel)]="maintenanceType"
              name="maintenanceType"
              required
              (change)="handleFrequenceChange()"
            >
              <option value="frequence">Fréquence</option>
              <option value="indicateur">Indicateur</option>
            </select>
          </div>
      
          <!-- Sélection de l'équipement -->
         
        </div>
      
        <!-- Deuxième partie - Champs conditionnels -->
        <div *ngIf="maintenanceType" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 border-t pt-6">
          <!-- Fréquence (si type est fréquence) -->
          <div *ngIf="maintenanceType === 'frequence'" class="col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                  <i class="fas fa-sync-alt text-blue-500 mr-2"></i> Fréquence
                </label>
                <select
                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                  [(ngModel)]="newMaintenance.repetitiontype"
                  name="repetitiontype"
                  required
                  (change)="handleFrequenceChange()"
                >
                  <option value="Ne_pas_repeter">Ne pas répéter</option>
                  <option value="TOUS_LES_JOURS">Tous les jours</option>
                  <option value="TOUS_LES_SEMAINES">Toutes les semaines</option>
                  <option value="MENSUEL">Mensuel</option>
                  <option value="ANNUEL">Annuel</option>
                </select>
              </div>
      
              <!-- Dates de répétition -->
              <div *ngIf="newMaintenance.repetitiontype !== 'Ne_pas_repeter'" class="col-span-2 grid grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                    <i class="fas fa-calendar-start text-blue-500 mr-2"></i> Date de début
                  </label>
                  <input
                    type="date"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                    [(ngModel)]="newMaintenance.startDaterep"
                    name="startDaterep"
                    required
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                    <i class="fas fa-calendar-end text-blue-500 mr-2"></i> Date de fin
                  </label>
                  <input
                    type="date"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                    [(ngModel)]="newMaintenance.endDaterep"
                    name="endDaterep"
                    required
                  />
                </div>
              </div>
      
              <!-- Jours de la semaine -->
              <div *ngIf="newMaintenance.repetitiontype === 'TOUS_LES_SEMAINES'" class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                  <i class="fas fa-calendar-week text-blue-500 mr-2"></i> Jours de la semaine
                </label>
                <div class="flex flex-wrap gap-4">
                  <div *ngFor="let day of getDays()" class="flex items-center">
                    <input type="checkbox" 
                          [id]="day" 
                          [checked]="selectedDays[day]" 
                          (change)="toggleDay(day)"
                          class="mr-2">
                    <label [for]="day" class="text-sm text-gray-700">{{day}}</label>
                  </div>
                </div>
              </div>
      
              <!-- Mois de l'année -->
              <div *ngIf="newMaintenance.repetitiontype === 'MENSUEL'" class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                  <i class="fas fa-calendar-alt text-blue-500 mr-2"></i> Mois de l'année
                </label>
                <div class="flex flex-wrap gap-4">
                  <div *ngFor="let mois of moisAnnee; let i = index" class="flex items-center">
                    <input
                      type="checkbox"
                      [id]="'mois' + i"
                      [value]="mois"
                      (change)="toggleMoisSelection(mois, $event)"
                      [checked]="newMaintenance.selectedmois.includes(mois)"
                      class="mr-2"
                    />
                    <label [for]="'mois' + i" class="text-sm text-gray-700">{{ mois }}</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
      
          <!-- Indicateurs (si type est indicateur) -->
          <div *ngIf="maintenanceType === 'indicateur'" class="col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Attributs de l'équipement -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                  <i class="fas fa-list-ul text-blue-500 mr-2"></i> Attributs de l'équipement
                </label>
                <select
                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                  [(ngModel)]="selectedAttribut"
                  name="selectedAttribut"
                  required
                >
                  <option value="" disabled>Sélectionnez un attribut</option>
                  <option *ngFor="let attr of selectedAttributs" [value]="attr.nom">
                    {{ attr.nom }} 
                  </option>
                </select>
                <p *ngIf="selectedAttributs.length === 0" class="text-xs text-red-500 mt-1 flex items-center">
                  <i class="fas fa-exclamation-circle mr-1"></i> Aucun attribut disponible
                </p>
              </div>
      
              <!-- Valeur NonSeuil -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                  <i class="fas fa-tachometer-alt text-blue-500 mr-2"></i> Valeur NonSeuil
                </label>
                <input
                  type="number"
                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                  [(ngModel)]="newMaintenance.seuil"
                  name="seuil"
                  min="0"
                  max="100"
                  step="0.01"
                  required
                  [disabled]="!selectedAttribut"
                />
                <p *ngIf="!selectedAttribut" class="text-xs text-gray-500 mt-1 flex items-center">
                  <i class="fas fa-info-circle mr-1"></i> Sélectionnez d'abord un attribut
                </p>
              </div>
            </div>
          </div>
      
          <!-- Commentaires - Section améliorée -->
          <div class="col-span-2 mt-4">
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
              <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                <i class="fas fa-comment-dots text-blue-500 mr-2 text-lg"></i> Commentaires
              </label>
              <textarea
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white"
                [(ngModel)]="newMaintenance.commentaires"
                name="commentaires"
                rows="4"
                placeholder="Décrivez les détails de la maintenance, les observations, ou toute information utile..."
              ></textarea>
              <div class="flex items-center text-xs text-gray-500 mt-1">
                <i class="fas fa-lightbulb text-blue-400 mr-1"></i> Ces informations seront visibles dans l'historique des maintenances
              </div>
            </div>
          </div>
        </div>
      
        <!-- Boutons de soumission -->
        <div class="flex justify-end gap-4 mt-8">
          <button
            type="button"
            class="px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 flex items-center"
            (click)="togglePanel()"
          >
            <i class="fas fa-times-circle mr-2 text-red-500"></i> Annuler
          </button>
          <button
            type="submit"
            class="px-6 py-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200 flex items-center shadow-md hover:shadow-lg"
          >
            <i class="fas fa-check-circle mr-2 text-white"></i> Ajouter la maintenance
          </button>
        </div>
      </form>

     
    </div>
  </div>
</div>

<!-- Style pour la barre de défilement -->
<style>
  .scrollbar-custom::-webkit-scrollbar {
    width: 8px;
  }

  .scrollbar-custom::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
/>